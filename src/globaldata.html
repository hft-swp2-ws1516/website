<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TLS analyser</title>
  <!-- CSS Stylesheets -->
  <link rel="stylesheet" href="css/statistics.css">
  <link href="css/site.css" rel="stylesheet">
  <link rel="stylesheet" href="css/toggle.css">
  <!-- Bootstrap -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <!-- Load c3.css -->
  <link href="css/c3/c3.css" rel="stylesheet" type="text/css">
  <!-- noUISlider c3.css -->
  <link rel="stylesheet" type="text/css" href="css/nouislider.min.css">
  <!-- jquery ui css -->
  <link rel="stylesheet" type="text/css" media="screen" href="css/datepicker/bootstrap-datepicker3.css">
</head>
<script type="text/javascript">
</script>
<body>
    <!-- Use this for the new menuitems. If they are any changes just remember you should change the menu.js file into js-folder
    and the menu item will display dynamicly -->
    <div id="nav01"></div>

    <div class="container">
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Graph</a>
          </div>
          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

            <form class="navbar-form navbar-left" role="search">

             <!-- Datepicker is shown if window width is higher than 768px -->
             <span id='datepicker'>
              <div class="input-group">
                <span class="input-group-addon" id="basic-addon3">From:</span>
                <div  id="filterDateStart" class="input-group date">
                  <input id="filterDateStartInput" required type="text" class="form-control">
                  <span class="input-group-addon">
                    <i class="glyphicon glyphicon-calendar"></i>
                  </span>
                </div>
              </div>
              <div class="input-group">
                <span class="input-group-addon" id="basic-addon3">To:</span>
                <div id="filterDateEnd" class="input-group date">
                  <input id="filterDateEndInput" required type="text" class="form-control">
                  <span class="input-group-addon">
                    <i class="glyphicon glyphicon-calendar"></i>
                  </span>
                </div>
              </div>
            </span>

            <!-- Timeslider is shown if window width is smaller than 768px -->
            <span id='timeslider'>

              <!-- noUIslider -->
              <div  id="slider-date"></div>

              Start: <span id="event-start"></span>
              End: <span id="event-end"></span> 

            </span>

            <div id="filterTLS" class="input-group">
              <span class="input-group-addon">TLS Protocol:</span>
              <input id="filterTLSProtocol" list="ssl_tls" class="form-control" onblur="manageFilterSelection()">
            </div>
            <datalist id="ssl_tls">
              <option value="SSLv2"></option>
              <option value="SSLv3"></option>
              <option value="TLSv1.0"></option>
              <option value="TLSv1.1"></option>
              <option value="TLSv1.2"></option>
            </datalist>
            <button type="submit" class="btn btn-default applytimespan">Submit</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
    <!-- Graphs -->

    <div id="charts">
      <!-- The charts are displayed here -->
      <div id="generic">
        <div id="loader"><img src="img/ajax-loader.gif"></div>
        <div id="chart"></div>
      </div>

      <div id="table-data"></div>

    </div>

  </div>

  <footer id="footer"></footer>
  <div id="subscribe"></div>
  <!-- Skripts are located in the end of the Body tag for faster Page Loading -->
  <!-- Load d3.js and c3.js -->
  <script src="js/c3/d3.min.js" charset="utf-8"></script>
  <script src="js/c3/c3.min.js"></script>
  <!-- JQuery CDN -->
  <script src="js/jquery-1.11.3.min.js"></script>
  <!-- Filter Menu -->
  <script type="text/javascript" src="js/filterData.js"></script>
  <!-- noUislider -->
  <script type="text/javascript" src="js/timeslider/nouislider.min.js"></script>
  <script type="text/javascript" src="js/timeslider/timeslider.js"></script>
  <!-- Bootstrap -->
  <script src="js/bootstrap.min.js"></script>
  <!-- for the menu -->
  <script src="js/menu.js"></script>
  <script type="text/javascript" src="js/datepicker/bootstrap-datepicker.js"></script>

  <script type="text/javascript" src="js/helperClass.js"></script>
  <script>

                                // Code will be executed  once the entire page (images or iframes), not just the DOM, is ready.
                                window.onload = function () {



                                    // Timeout setup for ajax
                                    // If the API is not responding within 3 seconds, the hard coded charts will be loaded
                                    $.ajaxSetup({
                                      timeout: 3000
                                    });


                                    // loading icon
                                    $(document).ajaxStart(function() {
                                        // show loader on start
                                        $("#loader").css("display","block");
                                      }).ajaxSuccess(function() {
                                        // hide loader on success

                                      });

                                      function loadChartByHash(hash){

                                       switch (hash) {
                                        case 'PFS':
                                        $("#chart").load("graphs/pfs.html");
                                        break;
                                        case 'DHE':
                                        $("#chart").load("graphs/dhe.html");
                                        break;
                                        case 'ECDHE':
                                        $("#chart").load("graphs/ecdhe.html");
                                        break;
                                        case 'logjam':
                                        $("#chart").load("graphs/logjam.html");
                                        break;
                                        case 'Ciphers':
                                        $("#chart").load("graphs/ciphers.html");
                                        break;
                                        case 'MAC':
                                        $("#chart").load("graphs/mac.html");
                                        break;
                                        default:
                                        $("#chart").load("graphs/pfs.html");
                                      }
                                    }
                                    $("#filterTLS").hide();
                                    loadChartByHash(window.location.hash.substring(1));

                                        // This is called when the reload button is clicked!
                                        $("button.applytimespan").click(function ()
                                        {
                                        // the called function depends of the hash value in the URL
                                        loadChartByHash(window.location.hash.substring(1));

                                      }
                                      );
                                        $( "#filterDateStartInput" ).change(function() {
                                         loadChartByHash(window.location.hash.substring(1));
                                       });

                                        $( "#filterDateEndInput" ).change(function() {
                                         loadChartByHash(window.location.hash.substring(1));
                                       });


                                        $("#loadPFS").click(function ()
                                        {
                                          $("#filterTLS").hide();
                                          $("#chart").load("graphs/pfs.html");
                                        }
                                        );

                                        $("#loadDHE").click(function ()
                                        {
                                         $("#chart").load("graphs/dhe.html");
                                         $("#filterTLS").hide();
                                       }
                                       );

                                        $("#loadECDHE").click(function ()
                                        {
                                         $("#filterTLS").hide();
                                         $("#chart").load("graphs/ecdhe.html");
                                       }
                                       );

                                        $("#loadlogjam").click(function ()
                                        {
                                         $("#filterTLS").hide();
                                         $("#chart").load("graphs/logjam.html");
                                       }
                                       );
                                        $("#loadCiphers").click(function ()
                                        {
                                         $("#filterTLS").show();
                                         $("#chart").load("graphs/ciphers.html");
                                       }
                                       );
                                        $("#loadMAC").click(function ()
                                        { 
                                         $("#filterTLS").hide();
                                         $("#chart").load("graphs/mac.html");
                                       }
                                       );


                                        $('#filterDateEnd').datepicker({
                                          format: "yyyy_mm",
                                          startView: 1,
                                          minViewMode: 1,
                                          autoclose: true,
                                        //setDate: new Date(2015,11),
                                        startDate: new Date(2015,10),
                                        endDate: new Date(),
                                      });

                                    // default end date, this syntax is weird but it worked
                                    $('#filterDateEnd').datepicker('setDate', new Date(new Date().getFullYear(), new Date().getMonth()));

                                    $('#filterDateStart').datepicker({
                                      format: "yyyy_mm",
                                      viewMode: "months", 
                                      minViewMode: "months",
                                      autoclose: true,
                                      startDate: new Date(2015,10),
                                      endDate: new Date(),
                                    }).on('changeDate', function (e) {
                                      var month = e.date.getMonth();
                                      var year = e.date.getFullYear();
                                      var startDate = new Date(year, month);
                                      $('#filterDateEnd').datepicker('setStartDate', startDate);
                                         //$('#filterDateEnd').datepicker('setDate',  startDate);
                                       });


                                    // set default Beginn date
                                    $('#filterDateStart').datepicker('setDate', new Date(2015,10));


                                  }
                                  ;

                                  </script>

                                </body>
                                </html>
